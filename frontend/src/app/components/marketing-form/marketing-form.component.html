<div class="marketing-form-container">
  <div class="form-header">
    <div class="header-content">
      <div class="title-section">
        <div class="icon-wrapper">
          <i class="fas fa-rocket"></i>
        </div>
        <div class="title-text">
          <h1 class="form-title">Marketing Campaign Form</h1>
          <p class="form-subtitle">Action Medical Institute & Action Cancer Hospital</p>
          <div class="generation-info">
            <i class="fas fa-clock"></i>
            <span>Generated on: {{ getCurrentDateTime() }}</span>
          </div>
        </div>
      </div>
      <div class="progress-indicator">
        <div class="progress-step active">
          <span class="step-number">1</span>
          <span class="step-label">Campaign Info</span>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step">
          <span class="step-number">2</span>
          <span class="step-label">Location</span>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step">
          <span class="step-number">3</span>
          <span class="step-label">Marketing Details</span>
        </div>
      </div>
    </div>
  </div>


  <form class="marketing-form" [formGroup]="marketingForm" (ngSubmit)="onSubmit()">
    <!-- Basic Campaign Information -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="fas fa-info-circle"></i>
        Campaign Information
      </h3>

      <div class="form-row">
        <!-- Campaign Manager Input -->
        <div class="form-group">
          <label class="form-label" for="campaignManager">Campaign Manager *</label>
          <div class="input-wrapper">
            <i class="fas fa-user input-icon"></i>
            <input type="text" id="campaignManager" class="form-control" formControlName="campaignManager"
              placeholder="Enter campaign manager name"
              [class.error]="campaignManager?.invalid && campaignManager?.touched">
          </div>
          <div class="error-message" *ngIf="campaignManager?.invalid && campaignManager?.touched">
            <i class="fas fa-exclamation-triangle"></i> Please enter campaign manager name
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="employeeCode">Employee ID</label>
          <div class="input-wrapper">
            <i class="fas fa-id-badge input-icon"></i>
            <input type="text" id="employeeCode" class="form-control" formControlName="employeeCode"
              placeholder="Enter employee ID">
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label class="form-label" for="taskDescription">Campaign Description *</label>
          <div class="input-wrapper">
            <i class="fas fa-align-left input-icon"></i>
            <textarea id="taskDescription" class="form-control" formControlName="taskDescription" rows="4"
              placeholder="Describe the marketing campaign details, objectives, and target audience..."
              [class.error]="taskDescription?.invalid && taskDescription?.touched">
            </textarea>
          </div>
          <div class="error-message" *ngIf="taskDescription?.invalid && taskDescription?.touched">
            <i class="fas fa-exclamation-triangle"></i> Please enter a campaign description (minimum 10 characters)
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="taskDate">Campaign Start Date *</label>
          <div class="input-wrapper">
            <i class="fas fa-calendar-alt input-icon"></i>
            <input type="date" id="taskDate" class="form-control" formControlName="taskDate"
              [class.error]="taskDate?.invalid && taskDate?.touched">
          </div>
          <div class="error-message" *ngIf="taskDate?.invalid && taskDate?.touched">
            <i class="fas fa-exclamation-triangle"></i> Please select a start date
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="deadline">Campaign End Date *</label>
          <div class="input-wrapper">
            <i class="fas fa-calendar-check input-icon"></i>
            <input type="date" id="deadline" class="form-control" formControlName="deadline"
              [class.error]="deadline?.invalid && deadline?.touched">
          </div>
          <div class="error-message" *ngIf="deadline?.invalid && deadline?.touched">
            <i class="fas fa-exclamation-triangle"></i> Please select an end date
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="priority">Campaign Priority *</label>
          <div class="input-wrapper">
            <i class="fas fa-flag input-icon"></i>
            <select id="priority" class="form-control" formControlName="priority"
              [class.error]="priority?.invalid && priority?.touched">
              <option value="Low">ðŸŸ¢ Low Priority</option>
              <option value="Medium">ðŸŸ¡ Medium Priority</option>
              <option value="High">ðŸŸ  High Priority</option>
              <option value="Urgent">ðŸ”´ Urgent</option>
            </select>
          </div>
          <div class="error-message" *ngIf="priority?.invalid && priority?.touched">
            <i class="fas fa-exclamation-triangle"></i> Please select priority
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Campaign Status</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="isUrgent" class="checkbox-input"
                [checked]="marketingForm.get('isUrgent')?.value" (change)="onCheckboxChange($event, 'isUrgent')">
              <span class="checkbox-custom"></span>
              <span class="checkbox-text">ðŸš¨ Mark as Urgent Campaign</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Project & Client Information -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="fas fa-building"></i>
        Project & Client Information
      </h3>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="clientName">Client/Department Name</label>
          <div class="input-wrapper">
            <i class="fas fa-building input-icon"></i>
            <input type="text" id="clientName" class="form-control" formControlName="clientName"
              placeholder="Enter client or department name">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="projectCode">Project Code</label>
          <div class="input-wrapper">
            <i class="fas fa-code input-icon"></i>
            <input type="text" id="projectCode" class="form-control" formControlName="projectCode"
              placeholder="e.g., MKT-2024-001">
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="consultantName">Consultant Name</label>
          <div class="input-wrapper">
            <i class="fas fa-user-tie input-icon"></i>
            <input type="text" id="consultantName" class="form-control" formControlName="consultantName"
              placeholder="Enter consultant name">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="campCode">Campaign Code</label>
          <div class="input-wrapper">
            <i class="fas fa-tag input-icon"></i>
            <input type="text" id="campCode" class="form-control" formControlName="campCode"
              placeholder="Enter campaign code">
          </div>
        </div>
      </div>
    </div>

    <!-- Location Details Section -->
    <div style="margin: 30px 0; padding: 30px; background: #f8f9fa; border-radius: 12px; border: 1px solid #e0e0e0;">

      <!-- Header -->
      <div
        style="display: flex; align-items: center; gap: 12px; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #ddd;">
        <i class="fas fa-map-marked-alt" style="font-size: 1.5rem; color: #5b7cff;"></i>
        <h3 style="margin: 0; color: #5b7cff; font-size: 1.3rem; font-weight: 600;">Location Details</h3>
      </div>

      <!-- Manual Toggle -->
      <div style="margin-bottom: 25px;">
        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 0.95rem;">
          <input type="checkbox" [checked]="manualLocationEntry" (change)="onManualToggle()"
            style="width: 18px; height: 18px; cursor: pointer;" />
          <span>Location not found? Add Manually</span>
        </label>
      </div>

      <!-- Dropdowns Grid -->
      <div *ngIf="!manualLocationEntry" style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">

        <!-- State -->
        <div>
          <label
            style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-map-marker-alt"></i>
            State
            <span style="color: red;">*</span>
          </label>
          <select formControlName="state" (change)="onStateChange($any($event.target).value)"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem; background: white;">
            <option value="">Select State</option>
            <option *ngFor="let state of states" [value]="state.stateId || state.id">{{ state.stateName || state.name }}
            </option>
          </select>
        </div>

        <!-- City -->
        <div>
          <label
            style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-city"></i>
            City
            <span style="color: red;">*</span>
          </label>
          <select formControlName="city" (change)="onCityChange($any($event.target).value)"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem; background: white;">
            <option value="">{{ !marketingForm.get('state')?.value ? 'Select state first' : 'Select City' }}</option>
            <option *ngFor="let city of cities" [value]="city.cityId || city.id">{{ city.cityName || city.name }}
            </option>
          </select>
        </div>

        <!-- Locality -->
        <div>
          <label
            style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-search-location"></i>
            Locality
          </label>
          <select formControlName="locality" (change)="onLocalityChange($any($event.target).value)"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem; background: white;">
            <option value="">Select Locality</option>
            <option *ngFor="let locality of localitySuggestions" [value]="locality">{{ locality }}</option>
          </select>
        </div>

        <!-- Pincode -->
        <div>
          <label
            style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-envelope-open-text"></i>
            Pincode
          </label>
          <select formControlName="pincode"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem; background: white;">
            <option value="">Auto-populated on Locality selection</option>
            <option *ngFor="let pincode of pincodeOptions" [value]="pincode">{{ pincode }}</option>
          </select>
        </div>
      </div>

      <!-- Manual Entry Fields -->
      <div *ngIf="manualLocationEntry"
        style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; background: #fff9e6; border-radius: 8px; border: 2px solid #ffd966;">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-map-marker-alt"></i> State *
          </label>
          <input type="text" placeholder="Type State Name" formControlName="customLocation"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem;" />
        </div>
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-city"></i> City *
          </label>
          <input type="text" placeholder="Type City Name" formControlName="customLocation"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem;" />
        </div>
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-search-location"></i> Locality
          </label>
          <input type="text" placeholder="Type Locality" formControlName="customLocation"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem;" />
        </div>
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
            <i class="fas fa-envelope-open-text"></i> Pincode
          </label>
          <input type="text" placeholder="Type Pincode" maxlength="6" formControlName="customLocation"
            style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem;" />
        </div>
      </div>

      <!-- Selected Location Summary -->
      <div
        *ngIf="marketingForm.get('state')?.value || marketingForm.get('city')?.value || marketingForm.get('locality')?.value || marketingForm.get('pincode')?.value"
        style="margin-top: 25px; padding: 15px; background: #e8f4fd; border: 1px solid #b3d9f2; border-radius: 6px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <i class="fas fa-info-circle" style="color: #1976d2;"></i>
          <strong style="color: #1976d2;">Selected Location</strong>
        </div>
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
          <span *ngIf="marketingForm.get('state')?.value"
            style="display: inline-flex; align-items: center; gap: 6px; background: white; padding: 6px 12px; border-radius: 4px; border: 1px solid #ddd;">
            <i class="fas fa-map-marker-alt" style="color: #5b7cff;"></i>
            {{ getStateName(marketingForm.get('state')?.value) }}
          </span>
          <span *ngIf="marketingForm.get('city')?.value"
            style="display: inline-flex; align-items: center; gap: 6px; background: white; padding: 6px 12px; border-radius: 4px; border: 1px solid #ddd;">
            <i class="fas fa-city" style="color: #5b7cff;"></i>
            {{ getCityName(marketingForm.get('city')?.value) }}
          </span>
          <span *ngIf="marketingForm.get('locality')?.value"
            style="display: inline-flex; align-items: center; gap: 6px; background: white; padding: 6px 12px; border-radius: 4px; border: 1px solid #ddd;">
            <i class="fas fa-search-location" style="color: #5b7cff;"></i>
            {{ marketingForm.get('locality')?.value }}
          </span>
          <span *ngIf="marketingForm.get('pincode')?.value"
            style="display: inline-flex; align-items: center; gap: 6px; background: white; padding: 6px 12px; border-radius: 4px; border: 1px solid #ddd;">
            <i class="fas fa-envelope-open-text" style="color: #5b7cff;"></i>
            {{ marketingForm.get('pincode')?.value }}
          </span>
        </div>
      </div>

    </div>

    <!-- Task Type & Location Selection -->
    <div class="form-section">
      <h3 class="section-title">Campaign Types & Locations</h3>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Campaign Types (Select all that apply)</label>
          <div class="multi-select-container">
            <div *ngIf="taskTypes.length === 0" class="loading-text">
              Loading campaign types...
            </div>
            <div class="checkbox-group" *ngFor="let taskType of taskTypes; trackBy: trackByTaskTypeId; let i = index">
              <label class="checkbox-label">
                <input type="checkbox" [value]="taskType.taskTypeId"
                  [checked]="selectedTaskTypes.includes(taskType.taskTypeId)"
                  (change)="onTaskTypeChange($event, taskType.taskTypeId)" class="checkbox-input">
                <span class="checkbox-custom"></span>
                <span class="checkbox-text">{{ taskType.typeName || taskType.name || 'Task Type ' + taskType.taskTypeId
                  }}</span>
              </label>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Marketing Campaign Details -->
    <div class="form-section">
      <h3 class="section-title">Campaign Details</h3>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="expectedReach">Expected Reach</label>
          <input type="number" id="expectedReach" class="form-control" formControlName="expectedReach"
            placeholder="e.g., 10000">
        </div>

        <div class="form-group">
          <label class="form-label" for="conversionGoal">Conversion Goal (%)</label>
          <input type="text" id="conversionGoal" class="form-control" formControlName="conversionGoal"
            placeholder="e.g., 5%">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="estimatedHours">Estimated Hours</label>
          <input type="number" id="estimatedHours" class="form-control" formControlName="estimatedHours"
            placeholder="e.g., 40" step="0.5">
        </div>

        <div class="form-group">
          <label class="form-label" for="budgetCode">Budget Code</label>
          <input type="text" id="budgetCode" class="form-control" formControlName="budgetCode"
            placeholder="e.g., BUD-2024-MKT">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label class="form-label" for="kpis">Key Performance Indicators (KPIs)</label>
          <textarea id="kpis" formControlName="kpis" rows="2" placeholder="Enter KPIs for this campaign..."></textarea>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label class="form-label" for="marketingMaterials">Marketing Materials Required</label>
          <textarea id="marketingMaterials" formControlName="marketingMaterials" rows="2"
            placeholder="List all marketing materials needed..."></textarea>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="approvalContact">Approval Contact</label>
          <input type="email" id="approvalContact" class="form-control" formControlName="approvalContact"
            placeholder="approver@company.com">
        </div>

        <div class="form-group">
          <label class="form-label" for="approvalRequired">Approval Required</label>
          <div class="checkbox-container">
            <input type="checkbox" id="approvalRequired" formControlName="approvalRequired" class="checkbox-input"
              [checked]="marketingForm.get('approvalRequired')?.value"
              (change)="onCheckboxChange($event, 'approvalRequired')">
            <label for="approvalRequired" class="checkbox-label">Requires approval</label>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label class="form-label" for="additionalNotes">Additional Notes</label>
          <textarea id="additionalNotes" formControlName="additionalNotes" rows="3"
            placeholder="Any additional notes or special instructions..."></textarea>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="resetForm()" [disabled]="isLoading">
        <i class="fas fa-undo"></i>
        Reset Form
      </button>

      <button type="button" class="btn btn-info" (click)="printForm()" [disabled]="isLoading">
        <i class="fas fa-print"></i>
        Print Form
      </button>

      <button type="submit" class="btn btn-primary" [disabled]="isLoading || !marketingForm.valid">
        <span *ngIf="isLoading" class="spinner"></span>
        <i class="fas fa-save" *ngIf="!isLoading"></i>
        {{ isLoading ? 'Creating Campaign...' : 'Create Marketing Campaign' }}
      </button>
    </div>

    <!-- Success Message -->
    <div class="success-message" *ngIf="showSuccess && successMessage">
      <i class="fas fa-check-circle"></i>
      <h4>{{ successMessage }}</h4>
      <span>Redirecting to dashboard...</span>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage"
      style="background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%); color: white; padding: 20px 30px; border-radius: 15px; margin: 20px 0; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);">
      <i class="fas fa-exclamation-triangle"></i>
      <div>
        <h4 style="margin: 0; font-size: 1.2rem; font-weight: 600;">Error</h4>
        <span>{{ errorMessage }}</span>
      </div>
    </div>
  </form>
</div>